{% extends 'index.html' %}
{% block title %}Blogs - gradnav{% endblock title %}

{% block content %}

<!DOCTYPE html>
<html>
<head>
    <title>CAO Calculator</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
            // Update points when a grade is selected
            $("select[name*='grade']").change(function () {
                var row = $(this).closest('tr');
                var level = row.find("select[name*='level']").val();
                var grade = $(this).val();
                var points = calculatePoints(level, grade);
                row.find("input[name*='points']").val(points);
                updateTotalPoints();
            });

            // Update points when a level is selected
            $("select[name*='level']").change(function () {
                var row = $(this).closest('tr');
                var level = $(this).val();
                var grade = row.find("select[name*='grade']").val();
                var points = calculatePoints(level, grade);
                row.find("input[name*='points']").val(points);
                updateTotalPoints();
            });

            // Function to calculate points based on level and grade
            function calculatePoints(level, grade) {
                var pointTable = {
                    'H1': 100, 'H2': 88, 'H3': 77, 'H4': 66, 'H5': 56, 'H6': 46, 'H7': 37, 'H8': 0,
                    'O1': 56, 'O2': 46, 'O3': 37, 'O4': 28, 'O5': 20, 'O6': 12, 'O7': 0, 'O8': 0
                };
                
                // Adjust the points based on the level
                if (level === 'O') {
                    // Reduce points for Ordinary level
                    grade = 'O' + grade.substring(1);  // Adjust grade prefix for Ordinary level
                }
                // Return the corresponding points from the table or 0 if not found
                return pointTable[grade] || 0;
            }

            // Function to update total points
            function updateTotalPoints() {
                var totalPoints = 0;
                $("input[name*='points']").each(function () {
                    totalPoints += parseInt($(this).val()) || 0;
                });
                $("#total_points").text("Total Points: " + totalPoints);
            }
        });
    </script>
</head>
<body>
    <h1>CAO Calculator</h1>
    <form method="post" action="{% url 'cao_calculator' %}">
        {% csrf_token %}
        <table>
            <thead>
                <tr>
                    <th>Subject</th>
                    <th>Level</th>
                    <th>Grade</th>
                    <th>Points</th>
                </tr>
            </thead>
            <tbody>
                {% for i in '12345678' %}
                    <tr>
                        <td>{% if forloop.counter == 1 %}Maths{% else %}Subject {{ forloop.counter }}{% endif %}</td>
                        <td>
                            <select name="level{{ forloop.counter }}">
                                <option value="H">Higher</option>
                                <option value="O">Ordinary</option>
                            </select>
                        </td>
                        <td>
                            <select name="grade{{ forloop.counter }}">
                                <option value="" selected disabled>Grade</option>
                                {% for grade in grades %}
                                    <option value="{{ grade }}">{{ grade }}</option>
                                {% endfor %}
                            </select>
                        </td>
                        <td><input type="text" name="points{{ forloop.counter }}" readonly></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit">Calculate</button>
    </form>
    <p id="total_points"></p>
</body>
</html>

{% endblock content %}