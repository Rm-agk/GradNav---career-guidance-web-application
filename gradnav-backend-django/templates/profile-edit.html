{% extends 'index.html' %}

{% block title %}Edit Profile - {{ request.user.username }}{% endblock %}

{% block content %}

<h1 class="display-4 text-center my-5">Edit Profile</h1>

<div class="container">
    <form action="" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="row">
            <!-- Profile Image -->
            <div class="col-lg-4 mb-3 d-flex flex-column align-items-center">
                <img src="{{ user_profile.profile_img.url }}" alt="profile-pic" class="rounded-circle mb-3" width="150" height="150">
                <input type="file" name="profile_img" class="form-control">
            </div>
            <!-- Profile Fields -->
            <div class="col-lg-8">
                <div class="row">
                    <!-- Personal Information -->
                    <div class="col-md-6">
                        <input type="text" name="firstname" value="{{ user_profile.user.first_name }}" class="form-control mb-3" placeholder="First Name" required>
                        <input type="text" name="lastname" value="{{ user_profile.user.last_name }}" class="form-control mb-3" placeholder="Last Name" required>
                        <input type="email" name="email" value="{{ user_profile.user.email }}" class="form-control mb-3" placeholder="Email" required>
                        <input type="text" name="username" value="{{ user_profile.user.username }}" class="form-control mb-3" placeholder="Username" required>
                        <input type="text" name="location" value="{{ user_profile.location }}" class="form-control mb-3" placeholder="Location" required>
                        <select class="form-select mb-3" name="gender" required>
                            <option value="">Choose Your Gender</option>
                            <option {% if user_profile.gender == 'Male' %}selected{% endif %} value="Male">Male</option>
                            <option {% if user_profile.gender == 'Female' %}selected{% endif %} value="Female">Female</option>
                            <option {% if user_profile.gender == 'Other' %}selected{% endif %} value="Other">Other</option>
                        </select>
                        <textarea class="form-control mb-3" name="bio" rows="3" placeholder="Your Bio" required>{{ user_profile.bio }}</textarea>
                    </div>
                    <!-- Skills and Interests -->
                    <div class="col-md-6">
                        <!-- Skills -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Skills</legend>
                            {% for skill in skills_form.fields.skills.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="skills" value="{{ skill.id }}" id="skill{{ skill.id }}"
                                       {% if skill in user_profile.skills.all %} checked {% endif %}>
                                <label class="form-check-label" for="skill{{ skill.id }}">
                                    {{ skill.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                        <!-- Subjects -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Subjects</legend>
                            {% for subject in subjects_form.fields.subjects.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="subjects" value="{{ subject.id }}" id="subject{{ subject.id }}"
                                       {% if subject in user_profile.subjects.all %} checked {% endif %}>
                                <label class="form-check-label" for="subject{{ subject.id }}">
                                    {{ subject.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                        <!-- Hobbies -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Hobbies</legend>
                            {% for hobby in hobbies_form.fields.hobbies.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="hobbies" value="{{ hobby.id }}" id="hobby{{ hobby.id }}"
                                       {% if hobby in user_profile.hobbies.all %} checked {% endif %}>
                                <label class="form-check-label" for="hobby{{ hobby.id }}">
                                    {{ hobby.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                        <!-- Character Traits -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Character Traits</legend>
                            {% for trait in character_traits_form.fields.character_traits.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="character_traits" value="{{ trait.id }}" id="trait{{ trait.id }}"
                                       {% if trait in user_profile.character_traits.all %} checked {% endif %}>
                                <label class="form-check-label" for="trait{{ trait.id }}">
                                    {{ trait.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                        <!-- Wants and Needs -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Wants and Needs</legend>
                            {% for want_need in wants_needs_form.fields.wants_needs.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="wants_needs" value="{{ want_need.id }}" id="wantneed{{ want_need.id }}"
                                       {% if want_need in user_profile.wants_needs.all %} checked {% endif %}>
                                <label class="form-check-label" for="wantneed{{ want_need.id }}">
                                    {{ want_need.name }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                        <!-- Background -->
                        <fieldset class="form-group">
                            <legend class="col-form-label pt-0">Background</legend>
                            {% for background in background_form.fields.background.queryset %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="background" value="{{ background.id }}" id="background{{ background.id }}"
                                       {% if background in user_profile.background.all %} checked {% endif %}>
                                <label class="form-check-label" for="background{{ background.id }}">
                                    {{ background.detail }}
                                </label>
                            </div>
                            {% endfor %}
                        </fieldset>
                    </div>
                </div>
                <!-- Submit Button -->
                <div class="mt-3 text-end">
                    <button type="submit" class="btn btn-success">Save Profile</button>
                </div>
            </div>
        </div>
    </form>
</div>

{% endblock content %}
